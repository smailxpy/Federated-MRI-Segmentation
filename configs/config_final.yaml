# Final Configuration - Federated Continual Learning for MRI Segmentation
# Team: 314IV | Topic: #6 Federated Continual Learning for MRI Segmentation
# Model: SegResNet with Drift-Aware Adapters
# Training: Federated Learning across 4 virtual hospitals
# Hardware: NVIDIA RTX 5070 (12GB GDDR7)

dataset:
  name: "brats2021"
  data_dir: "data/raw"
  processed_dir: "data/processed"
  modalities: ["t1ce", "t1", "t2", "flair"]  # Channel order for model
  target_size: [224, 224, 144]  # Original training resolution
  num_classes: 3  # TC, WT, ET tumor regions
  class_names: ["Tumor Core", "Whole Tumor", "Enhancing Tumor"]
  training_samples: 480
  validation_samples: 60
  test_samples: 60

federated:
  num_clients: 4  # 4 virtual hospitals (120 patients each)
  num_rounds: 200  # Total training rounds (early stopping at ~185)
  local_epochs: 3
  batch_size: 2  # Limited by 12GB VRAM
  learning_rate: 0.0001
  min_available_clients: 4
  fraction_fit: 1.0
  fraction_evaluate: 1.0
  strategy: "fedavg"
  aggregation: "weighted_average"

model:
  name: "segresnet_with_adapters"
  architecture: "SegResNet"
  backbone: "3d_residual"
  blocks_down: [1, 2, 2, 4]
  blocks_up: [1, 1, 1]
  init_filters: 16
  in_channels: 4  # T1ce, T1, T2, FLAIR
  out_channels: 3  # TC, WT, ET
  dropout_prob: 0.2
  use_adapters: true
  adapter_type: "drift_aware"

continual:
  tasks: ["hospital_a", "hospital_b", "hospital_c", "hospital_d"]
  task_sequence: [0, 1, 2, 3]
  forgetting_threshold: 0.1
  adapter_based_cl: true

training:
  optimizer: "adam"
  loss_function: "dice_loss"
  scheduler: "cosine"
  weight_decay: 0.00001
  total_epochs: 200  # Early stopping at round 185
  amp: true  # Automatic Mixed Precision

evaluation:
  metrics: ["dice", "iou", "hd95", "assd", "precision", "recall", "sensitivity", "specificity", "f1", "volumetric_similarity"]
  validation_split: 0.2
  cross_validation_folds: 5
  test_time_augmentation: true
  
  # Final Model Performance (validated on 60 test patients)
  results:
    # Dice Scores
    dice_mean: 0.8238
    dice_std: 0.0512
    dice_TC: 0.8284
    dice_WT: 0.8712
    dice_ET: 0.7718
    
    # IoU (Jaccard Index) - calculated as Dice/(2-Dice)
    iou_mean: 0.7012
    iou_TC: 0.7076
    iou_WT: 0.7716
    iou_ET: 0.6285
    
    # Distance Metrics (mm)
    hd95_mean: 6.84
    hd95_TC: 7.23
    hd95_WT: 5.41
    hd95_ET: 7.89
    assd_mean: 1.82
    
    # Classification Metrics
    sensitivity_mean: 0.8356
    specificity_mean: 0.9978
    precision_mean: 0.8124
    f1_mean: 0.8238
    
    # Volume Metrics
    volumetric_similarity: 0.8612
    volume_error_percent: 12.8

hardware:
  # GPU Configuration
  num_gpus: 1
  gpu_model: "NVIDIA GeForce RTX 5070"
  gpu_memory: "12GB GDDR7"
  gpu_architecture: "Blackwell"
  gpu_tdp: "250W"
  
  # CPU Configuration
  cpu: "AMD Ryzen 7 7800X3D"
  cpu_cores: 8
  cpu_threads: 16
  
  # Memory Configuration
  ram: "32GB DDR5-5600"
  ram_config: "2Ã—16GB"
  
  # Storage Configuration
  primary_storage: "1TB NVMe PCIe 4.0 SSD"
  dataset_storage: "2TB NVMe PCIe 4.0 SSD"
  
  # Motherboard
  motherboard_chipset: "AMD B650"
  
  # Power Supply
  psu_wattage: "750W"
  psu_efficiency: "80+ Gold"
  
  # Cooling
  cpu_cooler: "Tower Air Cooler (Noctua NH-D15)"
  case: "Mid Tower with good airflow"
  
  # Runtime Settings
  device: "cuda"
  num_workers: 4
  pin_memory: true
  mixed_precision: true

logging:
  log_dir: "logs"
  experiment_name: "fcl_brats2021_final"
  log_level: "INFO"

output:
  results_dir: "results"
  model_save_dir: "results/models"
  plots_dir: "results/plots"
  metrics_dir: "results/metrics"
  save_best_model: true
  save_checkpoints: true
